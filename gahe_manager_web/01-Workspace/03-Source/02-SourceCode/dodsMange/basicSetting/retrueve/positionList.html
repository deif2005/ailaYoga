<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="stylesheet" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" href="../../css/same.css">
    <title>岗位列表</title>
    <style>
        .header{
            margin-bottom: 0px;
        }
        .title{
            min-height: 100px;
            border-bottom: 1px solid #f0f0f0;
            line-height: 100px;
            padding-left: 20px;
            padding-right: 40px;
        }
        .title:after{
            content: '';
            display: block;
            clear: both;
        }
        .leftcol{
            display: inline-block;
            vertical-align: middle;
        }
        .rightcol{
            display: inline-block;
            /*vertical-align: middle;*/
            float: right;
        }
        .leftcol select{
            /*border: none;*/
            outline: none;
        }
        .titlename{
            line-height: 14px;
            margin-right: 50px;
        }
        #platform{
            margin-right: 50px;
        }
        .search{
            display: inline-block;
            margin-left: 20px;
        }
        .searchinput{
            width: 200px;
            height: 30px;
            border: 1px solid #f0f0f0;
        }

        .searchbtn {
            height: 30px;
            width: 90px;
            background: #49aceb;
            display: inline-block;
            color: #ffffff;
            vertical-align: middle;
            line-height: 30px;
            text-align: center;
            border-bottom-right-radius: 5px;
            border-top-right-radius: 5px;
            background-image: url("../../images/powerbtn/sou_suo.png");
            background-repeat: no-repeat;
            background-position: 10px center;
            padding-left: 15px;
            margin-left: -4px;
        }

        .addPositionBtn{
            height: 30px;
            width:120px;
            background: #49aceb;
            display: inline-block;
            color: #ffffff;
            vertical-align: middle;
            line-height: 30px;
            text-align: center;
            border-radius: 5px;
            background-image: url('../../images/powerbtn/tian_jia.png');
            background-repeat: no-repeat;
            background-position: 4px center;
            padding-left: 15px;
            margin-left: 10px;
            cursor: pointer;
        }
        .selectPositionBtn{
            height: 30px;
            width: 120px;
            background: #49aceb;
            display: inline-block;
            color:#ffffff;
            vertical-align: middle;
            line-height: 30px;
            text-align: center;
            border-radius: 5px;
            background-image: url("../../images/powerbtn/xuan_ze.png");
            background-repeat: no-repeat;
            background-position: 4px center;
            padding-left: 15px;
            margin-right: 50px;
            cursor: pointer;
        }
        .listtitle span{
            display: inline-block;
            width: 100px;
            text-align: center;
            height: 50px;
            line-height: 50px;
            margin-right: 30px;
        }

        .positionlist  li div{
            display: inline-block;
            width: 100px;
            min-width: 100px;
            text-align: center;
            height: 50px;
            line-height: 50px;
            vertical-align: middle;
            margin-right: 30px;
        }
        .positionlist  li .dataoperate{
            width: 150px;
        }
        .positionlist  li{
            border-bottom: 1px solid #f0f0f0;
        }
        .dataoperate:after{
            content: '';
            display: block;
            clear: both;
        }
        .edit{
            float: left;
            margin-left:10px;
            color: #49aceb;
        }
        .stop{
            float: left;
            margin-left:10px;
            color: #49aceb;
        }
        .delete{
            float: left;
            margin-left:10px;
            color: #49aceb;
        }


        /*分页样式*/
        button{
            padding:5px;
            margin:5px;
            width: 35px;
            height: 35px;
            background: #ffffff;
            border: 1px solid #f0f0f0;
        }
        .prev-btn,.next-btn{
            padding:5px;
            margin:5px;
            width: 55px;
            height: 35px;
        }
        .first-btn,.last-btn{
            padding:5px;
            margin:5px;
            width: 45px;
            height: 35px;
        }
        input{
            width:50px;
            text-align:center;
        }
        .active-nick{
            background: #49aceb;
            color: #f0f0f0;
        }

        .btn-box-nick,.paexplain{
            display: inline-block;
        }
        .paexplain{
            margin-left: 30px;
            color: #939393;
        }
        .btn-box-nick{
            margin-left: 25%;
            color: #49aceb;
        }


        .positionContent:after{
            content: '';
            display: block;
            clear: both;
        }
        .positionContent{
            border-top: 1px solid #f0f0f0;
            border-bottom: 1px solid #f0f0f0;
            padding: 0 30px;
        }

        .noSelect{
            margin: 20px auto;

        }
        .noSelect ul{
            height: 500px;
            overflow: auto;
            padding: 30px 10px;
            border: 1px solid #939393;
        }

        .positionContent li{
            margin-bottom: 20px;
        }
        .positionContent li input{
            margin-right:30px;
        }
        .positionlist{
            min-height: 600px;
        }
        .btnList:after{
            content: '';
            display: block;
            clear: both;
        }
    </style>
</head>
<body>
<div class="left_side">
    <iframe name="iframes" id="iframe2" src="../../leftNav.html" frameborder="0"></iframe>
</div>
<div class="right_side">
    <div class="header"><span class="dods">多点运动助手后台管理系统</span><div class="imgdiv"><img class="head_photo" src="../../images/tou_xiang.png" ></div><span class="name">陈老师</span><span class="logout">退出</span></div>
    <div class="title">
        <div class="leftcol">
            <span class="titlename" style="font-weight: bold;font-weight: bold">岗位信息</span>
            <span>平台：</span>
            <select  id="platform" onChange="selectPlatform();">
                <option value="">系统信息设置</option>
                <option value="">商家信息设置</option>
            </select>
            <span class="business">商家：</span>
            <select  id="business" onChange="pagination(getBusinesspositionList);">
                <!--商家下拉列表-->
            </select>

        </div>
        <div class="rightcol">
            <span class="selectPositionBtn">选择岗位模块</span>
            <span class="addPositionBtn">添加岗位模块</span>

        </div>
    </div>

    <div id="windownbg" style="width: 100%;height: 100%;display: none;filter:alpha(opacity=0);background: rgba(222,222,222,0.5);z-index: 999901;position: absolute;top: 0px;left: 0px">
        <div id="windown-box" style="width: 30%;background: #ffffff; margin: 60px auto;">
            <div style="height: 55px;line-height: 55px;padding: 0 30px;font-weight: bold ">选择岗位模块</div>
            <div class="positionContent">
                <div class="noSelect">
                    <ul>
                        <!--未选择平台岗位列表-->
                    </ul>
                </div>
            </div>
            <div class="btnList"><div class="back">返回</div><div class="modelsure save" id="savePosition">保存</div></div>


        </div>
    </div>
    <ul class="positionlist">

        <!--商家岗位列表或平台岗位列表展示-->
    </ul>
    <!--分页组件容器-->
    <div class="pagination-nick"></div>
    <!--添加系统职位-->
    <div id="addBackground" style=" display: none;width: 100%;height: 100%;filter:alpha(opacity=0);background: rgba(222,222,222,0.5);z-index: 999901;position: absolute;top: 0px;left: 0px">
        <div style="max-width: 450px;background: #ffffff; margin: 300px auto">
            <div style="height: 40px;line-height: 40px;padding: 0 10px;font-weight: bold">添加系统部门</div>
            <ul class="positionInfo" style="padding: 10px 20px;border-top:1px solid #f0f0f0;border-bottom: 1px solid #f0f0f0 ">
                <li style="margin-bottom: 15px"><span style="margin-right: 30px">【系统】</span></li>
                <li><input class="addPositionName" type="text" style="width: 300px ;height: 50px"></li>
            </ul>
            <div class="btnList"><div class="back addCancle">返回</div><div class="save addSure">保存</div></div>
        </div>
    </div>
    <!--编辑系统职位-->
    <div id="editBackground" style=" display: none;width: 100%;height: 100%;filter:alpha(opacity=0);background: rgba(222,222,222,0.5);z-index: 999901;position: absolute;top: 0px;left: 0px">
        <div style="max-width: 450px;background: #ffffff; margin: 300px auto">
            <div style="height: 40px;line-height: 40px;padding: 0 10px;font-weight: bold">编辑系统职位</div>
            <ul class="positionInfo" style="padding: 10px 20px;border-top:1px solid #f0f0f0;border-bottom: 1px solid #f0f0f0 ">
                <li style="margin-bottom: 15px"><span style="margin-right: 30px">【系统】</span></li>
                <li><input class="editPositionName" type="text" style="width: 300px ;height: 50px"></li>
            </ul>
            <div class="btnList"><div class="back editCancle">返回</div><div class="save editSure">保存</div></div>
        </div>
    </div>
    <!--添加商家职位-->
    <div id="addBusiBackground" style=" display: none;width: 100%;height: 100%;filter:alpha(opacity=0);background: rgba(222,222,222,0.5);z-index: 999901;position: absolute;top: 0px;left: 0px">
        <div style="max-width: 450px;background: #ffffff; margin: 300px auto">
            <div style="height: 40px;line-height: 40px;padding: 0 10px;font-weight: bold">添加商家职位</div>
            <ul class="positionInfo" style="padding: 10px 20px;border-top:1px solid #f0f0f0;border-bottom: 1px solid #f0f0f0 ">
                <li class="addbusi" style="margin-bottom: 15px"><span style="margin-right: 30px;display: inline-block;width: 100px">商家编号</span><span>商家名称</span></li>
                <li><input class="addBusiPositionName" type="text" style="width: 300px ;height: 50px"></li>
            </ul>
            <div class="btnList"><div class="back addBusiCancle">返回</div><div class="save addBusiSure">保存</div></div>
        </div>
    </div>
    <!--编辑商家职位-->
    <div id="editBusiBackground" style=" display: none;width: 100%;height: 100%;filter:alpha(opacity=0);background: rgba(222,222,222,0.5);z-index: 999901;position: absolute;top: 0px;left: 0px">
        <div style="max-width: 450px;background: #ffffff; margin: 300px auto">
            <div style="height: 40px;line-height: 40px;padding: 0 10px;font-weight: bold">编辑商家职位</div>
            <ul class="positionInfo" style="padding: 10px 20px;border-top:1px solid #f0f0f0;border-bottom: 1px solid #f0f0f0 ">
                <li class="editbusi"  style="margin-bottom: 15px"><span style="margin-right: 30px;display: inline-block;width: 100px">商家编号</span><span>商家名称</span></li>
                <li><input class="editBusiPositionName" type="text" style="width: 300px ;height: 50px"></li>
            </ul>
            <div class="btnList"><div class="back editBusiCancle">返回</div><div class="save editBusiSure">保存</div></div>
        </div>
    </div>
    <!--删除弹框-->
    <div id="deleteBackground" style=" display: none;width: 100%;height: 100%;filter:alpha(opacity=0);background: rgba(222,222,222,0.5);z-index: 999901;position: absolute;top: 0px;left: 0px">
        <div id="alert-box" style="max-width: 450px;background: #ffffff; margin: 300px auto;padding: 30px 0px 5px">
            <img style="display: block;margin: 0px auto 40px" src="../../images/jinggao.png" alt="警告">
            <div style="color: #ff4138;font-size: 14px;text-align: center">是否确认删除，删除将不可恢复</div>
            <div class="btnList"><div class="back deleteCancle">取消</div><div class="save deleteSure">确认</div></div>
        </div>
    </div>
</div>
</body>
<script type="text/javascript" src="../../js/jquery.min.js"></script>
<script type="text/javascript" src="../../js/same.js"></script>
<script type="text/javascript" src="../../js/doublebox-bootstrap.js"></script>
<script type="text/javascript">

    $('.logout').click(function () {
        logout('../../login.html');
    });
    // 父页面获取子页面iframe2的元素
    var iframe2 = document.getElementById("iframe2");

    iframeIsLoad(iframe2,function(){

//    iframe2.contentWindow.b();   // 打印出 我是子页面
        var iframeDom = $("#basicSetting",iframe2.contentWindow.document);
        var iframeDom2 = $("#basicSettingUl",iframe2.contentWindow.document);
        var iframeDom3 = $("#position",iframe2.contentWindow.document);
        iframeDom.addClass('active')
        iframeDom3.addClass('active')
        iframeDom2.addClass('menu-open')
        iframeDom2.css({
            'display':'block'
        })
    });

//获取五个弹出框 系统职位录入框 系统职位编辑框 商家职位录入框 商家职位编辑框 删除框
    var addBackground = document.getElementById("addBackground");
    var editBackground = document.getElementById("editBackground");
    var addBusiBackground = document.getElementById("addBusiBackground");
    var editBusiBackground = document.getElementById("editBusiBackground");
    var deleteBackground = document.getElementById("deleteBackground");

    //根据下拉列表的选中状态页面进行不同的显示
    var platform=$("#platform option:selected").text();//下拉列表的显示内容
    $('.selectPositionBtn').hide();//选择按钮隐藏
    $('#business').hide();
    $('.business').hide();
    function selectPlatform() {
        platform=$("#platform option:selected").text();  //获取选中的项
        if(platform == '系统信息设置'){
            $('.selectPositionBtn').hide();
            $('#business').hide();
            $('.business').hide();
            //调用系统平台岗位列表函数
            pagination(getpositionList);

        }
        if(platform == '商家信息设置'){
            $('.selectPositionBtn').show();
            $('#business').show();
            $('.business').show();
            $.ajax({
                xhrFields: {
                    withCredentials: true
                },
                type: "POST",
                url: defiUrl+"/api/SystemBase/v1/getAllBusinessInfo",
                async: false,
                dataType: "json",
                data: {
                    'token':sessionStorage.getItem('token'),
                    'businessType':1
                },
                success: function (data) {
                    if(data.result.code==4001){
                        alert('登录信息已过期，请重新登录！');
                        window.location.href='../../login.html';
                    }else if(data.result.code==4004){
                        alert('您太久没操作了，请重新登录！');
                        window.location.href='../../login.html';
                    }else if(data.result.code ==4003){
                        alert('业务异常！');
                    }else if(data.result.code==0){
                        $('#business option').remove();
                        for(var i =0;i<data.datas.businessInfo.length;i++){
                            $('#business').append('<option class="'+data.datas.businessInfo[i].businessSerialId+'" value="'+data.datas.businessInfo[i].id+'">'+data.datas.businessInfo[i].businessName+'</option>')
                        }
                        //调用商家岗位列表函数
                        pagination(getBusinesspositionList);
                    }

                }
            });

        }
    }
    // 点击新增按钮  调用不同的 录入接口
    // 点击新增按钮  调用不同的 录入接口
    $('.addPositionBtn').click(function () {
        if(platform == '系统信息设置'){
            addBackground.style.display ='block';
            $(".addSure").unbind("click");
            $(".addCancle").unbind("click");
            $('.addSure').click(function () {
                var positionName = $('.addPositionName').val();
                var creator = sessionStorage.getItem('manageId');
                if(positionName!=''){
                    addPositionInfo(positionName,creator);
                }else {
                    alert('请填写内容后提交！')
                }

            });
            $('.addCancle').click(function () {
                addBackground.style.display ='none';
            })

        }
        if(platform == '商家信息设置'){
            var businessId =$("#business option:selected").val();
            addBusiBackground.style.display ='block';
            $('.addbusi span').eq(0).html($("#business option:selected")[0].className)//获取商家编号
            $('.addbusi span').eq(1).html($("#business option:selected").text())//获取商家名称
            $(".addBusiSure").unbind("click");
            $(".addBusiCancle").unbind("click");
            $('.addBusiSure').click(function () {
                var busiPositionName = $('.addBusiPositionName').val();
                var creator = sessionStorage.getItem('manageId');
                if(busiPositionName!=''){
                    addBusiPositionInfo(busiPositionName,businessId,creator);
                }else {
                    alert('请填写内容后提交！');
                }

            });
            $('.addBusiCancle').click(function () {
                addBusiBackground.style.display ='none';
            })
        }
    })

    /**
     * 系统岗位录入接口
     * @param positionName 岗位名称
     * @param creator 录入人
     */
    function addPositionInfo(positionName,creator) {
        $.ajax({
            xhrFields: {
                withCredentials: true
            },
            type: "POST",
            url: defiUrl+"/api/SystemBase/v1/addPosition",
            async: true,
            dataType: "json",
            data: {
                'token':sessionStorage.getItem('token'),
                'positionName': positionName,
                'creator':creator
            },
            success: function (data) {
                if(data.result.code==4001){
                    alert('登录信息已过期，请重新登录！');
                    window.location.href='../../login.html';
                }else if(data.result.code==4004){
                    alert('您太久没操作了，请重新登录！');
                    window.location.href='../../login.html';
                }else if(data.result.code ==0){
                    alert('录入成功');
                    addBackground.style.display ='none';
                    $('.addPositionName').val('');
                    pagination(getpositionList);
                }else if(data.result.code ==4003) {
                    alert('业务异常！');
                }


            }
        });
    }
    /**
     * 商家岗位录入接口
     * @param positionName 岗位名称
     * @param businessId 商家id
     * @param creator 录入人
     */
    function addBusiPositionInfo(positionName,businessId,creator) {
        $.ajax({
            xhrFields: {
                withCredentials: true
            },
            type: "POST",
            url: defiUrl+"/api/SystemBase/v1/addBusiPosition",
            async: true,
            dataType: "json",
            data: {
                'token':sessionStorage.getItem('token'),
                'positionName': positionName,
                'businessId':businessId,
                'creator':creator
            },
            success: function (data) {
                if(data.result.code==4001){
                    alert('登录信息已过期，请重新登录！');
                    window.location.href='../../login.html';
                }else if(data.result.code==4004){
                    alert('您太久没操作了，请重新登录！');
                    window.location.href='../../login.html';
                }else if(data.result.code ==0){
                    alert('录入成功');
                    addBusiBackground.style.display ='none';
                    $('.addBusiPositionName').val('');
                    pagination(getBusinesspositionList);
                }else if(data.result.code ==4003) {
                    alert('业务异常！');
                }

            }
        });
    }



    /**
     * 商家岗位批量选择录入接口
     * @param positionIdStr 岗位id字符串
     * @param positionNameStr 岗位名称字符串
     * @param businessId 商家id
     * @param creator 录入人
     */
    function moreBusipositionInfo(positionIdStr,positionNameStr,businessId,creator) {
        $.ajax({
            xhrFields: {
                withCredentials: true
            },
            type: "POST",
            url: defiUrl+"/api/SystemBase/v1/addBatchBusiPosition",
            async: true,
            dataType: "json",
            data: {
                'token':sessionStorage.getItem('token'),
                'positionIdStr': positionIdStr,
                'positionNameStr': positionNameStr,
                'businessId':businessId,
                'creator':creator
            },
            success: function (data) {
                if(data.result.code==4001){
                    alert('登录信息已过期，请重新登录！');
                    window.location.href='../../login.html';
                }else if(data.result.code==4004){
                    alert('您太久没操作了，请重新登录！');
                    window.location.href='../../login.html';
                }else if(data.result.code ==0){
                    alert('录入成功');
                    $('#windownbg').hide();
                    pagination(getBusinesspositionList);
                }else if(data.result.code ==4003) {
                    alert('业务异常！');
                }


            }
        });
    }

    //点击选择岗位按钮调用获取岗位列表接口
    $('.selectPositionBtn').click(function () {
        $('#windownbg').show();//选择岗位框显示
        getAllpositionInfo();//调用获取所有平台岗位列表和所有商家列表
        $('.back').click(function () {
            $('#windownbg').hide();
        })
    })
    //所有模块删除已选择的模块 得到可以选择的模块
    function removeByValue(arr, val) {
        for (var i = 0; i < arr.length; i++) {
            if (arr[i].positionName == val) {
                arr.splice(i, 1);
                break;
            }
        }
    }

    $('#savePosition').click(function () {
        var arr1 = [];//定义一个存放选择岗位id的数组
        var arr2 =[];//定义一个存放选择岗位名称的数组
        for(var i =0;i<$('input[name="noSelectposition"]:checked').parent().length;i++){
            //多选父级元素的text 跟check顺序相反所以用 像头部插入数组保证顺序一致
            arr1.unshift($('input[name="noSelectposition"]:checked').parent().eq(i).text())
        }
        for(var i =0;i<$('input[name="noSelectposition"]:checked').length;i++){
            //多选元素的val 跟check顺序一致所以用 像尾部插入数组保证顺序一致
            arr2.push($('input[name="noSelectposition"]:checked').eq(i).val())
        }
        var positionNameStr = arr1.join(',');//得到选择岗位id的，隔开的字符串
        var positionIdStr = arr2.join(',');//得到选择岗位名称的，隔开的字符串
        var businessId =$("#business option:selected").val();
        var creator = sessionStorage.getItem('manageId');
        moreBusipositionInfo(positionIdStr,positionNameStr,businessId,creator)
    })

    /**
     * 获取所有平台岗位的列表
     */
    function getAllpositionInfo() {
        $.ajax({
            xhrFields: {
                withCredentials: true
            },
            type: "POST",
            url: defiUrl+"/api/SystemBase/v1/getAllPositionInfo",
            async: true,
            dataType: "json",
            data:{
                'token':sessionStorage.getItem('token')
            },
            success: function (data) {
                if(data.result.code==4001){
                    alert('登录信息已过期，请重新登录！');
                    window.location.href='../../login.html';
                }else if(data.result.code==4004){
                    alert('您太久没操作了，请重新登录！');
                    window.location.href='../../login.html';
                }else if(data.result.code ==4003){
                    alert('业务异常！');
                }else if(data.result.code==0){
                    var allpositionName = [];
                    //将所有平台岗位的名称和id以对象形式添加到数组
                    for(var i=0;i<data.datas.positionList.length;i++){
                        var obj = {
                            'positionName':'',
                            'positionId':''
                        };
                        obj.positionName = data.datas.positionList[i].positionName;
                        obj.positionId = data.datas.positionList[i].id;
                        allpositionName.push(obj)
                    }
                    getAllBusinesspositionInfo(allpositionName)//调用获取所有商家岗位列表的接口
                }

            }
        });
    }

    /**
     * 获取商家所有岗位列表接口
     * @param arr 平台所有岗位的列表
     */
    function getAllBusinesspositionInfo(arr) {
        var businessId =$("#business option:selected").val();
        $.ajax({
            xhrFields: {
                withCredentials: true
            },
            type: "POST",
            url: defiUrl+"/api/SystemBase/v1/getAllBusiPositionInfo",
            async: true,
            dataType: "json",
            data: {
                'token':sessionStorage.getItem('token'),
                'businessId':businessId
            },
            success: function (data) {
                if(data.result.code==4001){
                    alert('登录信息已过期，请重新登录！');
                    window.location.href='../../login.html';
                }else if(data.result.code==4004){
                    alert('您太久没操作了，请重新登录！');
                    window.location.href='../../login.html';
                }else if(data.result.code ==4003){
                    alert('业务异常！');
                }else if(data.result.code==0){
                    for (var i = 0;i<data.datas.positionList.length;i++){
                        //所有岗位中删除已选岗位得到未选岗位
                        removeByValue(arr, data.datas.positionList[i].positionName);
                    }
                    $('.noSelect ul li').remove();
                    for(var j =0;j<arr.length;j++){
                        //将未选岗位展示给用户选择
                        $('.noSelect ul').append('<li><label><input name="noSelectposition" type="checkbox" value="'+arr[j].positionId+'" />'+arr[j].positionName+'</label></li>')
                    }
                }


            }
        });
    }
    /**
     * 获取所有平台分页岗位列表接口
     * @param page 分页页数
     */
    function getpositionList(page) {
        $.ajax({
            xhrFields: {
                withCredentials: true
            },
            type: "POST",
            url: defiUrl+"/api/SystemBase/v1/listPositionInfo",
            async: false,
            dataType: "json",
            data: {
                'token':sessionStorage.getItem('token'),
                'page':page
            },
            success: function (data) {
                if(data.result.code==4001){
                    alert('登录信息已过期，请重新登录！');
                    window.location.href='../../login.html';
                }else if(data.result.code==4004){
                    alert('您太久没操作了，请重新登录！');
                    window.location.href='../../login.html';
                }else if(data.result.code ==4003){
                    alert('业务异常！');
                }else if(data.result.code==0){
                    var positionList =data.datas.positionList;
                    num = data.datas.count;//分页总数
                    $('.positionlist li').remove();//先删除已选li
                    $('.positionlist').append('<li style="font-weight: bold"><div>编号</div><div>名称</div><div>岗位模块</div><div class="dataoperate">操作</div></li>')
                    for(var i =0;i<positionList.length;i++){
                        //在创建新的li显示未选岗位
                        $('.positionlist').append('<li><div class="datanumber">'+positionList[i].positionSerialId+'</div><div>平台</div><div class="datamodel">'+positionList[i].positionName+'</div><div class="dataoperate"><span class="edit positionEdit" style="cursor: pointer">编辑</span><span class="stop">停用</span><span class="delete positionDelete" style="cursor: pointer">删除</span></div></li>')

                    }
                    $('.positionEdit').click(function () {
                        //编辑点击 出现编辑框
                        var editIndex = $(this).index('.positionEdit');//获取当前点击编辑的按钮在所有编辑按钮的索引
                        var id = positionList[editIndex].id;//获取当前点击的id
                        editBackground.style.display ='block';
                        $('.editPositionName').val(positionList[editIndex].positionName)
                        $(".editSure").unbind("click");
                        $(".editCancle").unbind("click");
                        $('.editSure').click(function () {
                            //点击编辑框的确认 调用编辑系统部门接口
                            var positionName = $('.editPositionName').val();
                            if(positionName!=''){
                                editPosition(id,positionName);
                            }else {
                                alert('请填写内容后提交！');
                            }

                        });
                        $('.editCancle').click(function () {
                            editBackground.style.display ='none';
                        })
                    })
                    $('.positionDelete').click(function () {
                        //删除按钮点击 出现警示弹框
                        var deleteIndex = $(this).index('.positionDelete');//获取当前点击删除的按钮在所有删除按钮的索引
                        var id = positionList[deleteIndex].id;//获取当前点击的id
                        deleteBackground.style.display ='block';
                        $(".deleteSure").unbind("click");
                        $(".deleteCancle").unbind("click");
                        $('.deleteSure').click(function () {
                            //点击删除框的确认 调用删除系统部门接口
                            deletePosition(id);
                        })
                        $('.deleteCancle').click(function () {
                            //点击删除框的取消  弹框消失 不做操作
                            deleteBackground.style.display ='none';
                        })
                    })
                }

            }
        });
    }
    /**
     * 获取商家分页岗位列表接口
     * @param businessId 商家id
     * @param page 分页页数
     */
    function getBusinesspositionList(page) {
        var businessId =$("#business option:selected").val();
        $.ajax({
            xhrFields: {
                withCredentials: true
            },
            type: "POST",
            url: defiUrl+"/api/SystemBase/v1/listBusiPositionInfo",
            async: false,
            dataType: "json",
            data: {
                'token':sessionStorage.getItem('token'),
                'businessId':businessId,
                'page':page
            },
            success: function (data) {
                if(data.result.code==4001){
                    alert('登录信息已过期，请重新登录！');
                    window.location.href='../../login.html';
                }else if(data.result.code==4004){
                    alert('您太久没操作了，请重新登录！');
                    window.location.href='../../login.html';
                }else if(data.result.code ==4003){
                    alert('业务异常！');
                }else if(data.result.code==0){
                    var positionList =data.datas.positionList;
                    num = data.datas.count;//分页总数
                    $('.positionlist li').remove();//先删除已选li
                    $('.positionlist').append('<li style="font-weight: bold"><div>编号</div><div>商家名称</div><div>岗位模块</div><div class="dataoperate">操作</div></li>')
                    for(var i =0;i<positionList.length;i++){
                        //在创建新的li显示未选岗位
                        $('.positionlist').append('<li><div class="datanumber">'+positionList[i].positionSerialId+'</div><div>'+$("#business option:selected").text()+'</div><div class="datamodel">'+positionList[i].positionName+'</div><div class="dataoperate"><span class="edit busiPositionEdit" style="cursor: pointer">编辑</span><span class="stop">停用</span><span class="delete busiPositionDelete" style="cursor: pointer">删除</span></div></li>')

                    }
                    $('.busiPositionEdit').click(function () {
                        //编辑点击 出现编辑框
                        var editIndex = $(this).index('.busiPositionEdit');//获取当前点击编辑的按钮在所有编辑按钮的索引
                        var id = positionList[editIndex].id;//获取当前点击的id
                        editBusiBackground.style.display ='block';
                        $('.editBusiPositionName').val(positionList[editIndex].positionName);
                        $('.editbusi span').eq(0).html($("#business option:selected")[0].className)//获取商家编号
                        $('.editbusi span').eq(1).html($("#business option:selected").text())//获取商家名称
                        $(".editBusiSure").unbind("click");
                        $(".editBusiCancle").unbind("click");
                        $('.editBusiSure').click(function () {
                            //点击编辑框的确认 调用编辑系统部门接口
                            var positionName = $('.editBusiPositionName').val();
                            if(positionName!=''){
                                editBusinessPosition(id,positionName);
                            }else {
                                alert('请填写内容后提交！');
                            }

                        });
                        $('.editBusiCancle').click(function () {
                            editBusiBackground.style.display ='none';
                        })
                    })
                    $('.busiPositionDelete').click(function () {
                        //删除按钮点击 出现警示弹框
                        var deleteIndex = $(this).index('.busiPositionDelete');//获取当前点击删除的按钮在所有删除按钮的索引
                        var id = positionList[deleteIndex].id;//获取当前点击的id

                        deleteBackground.style.display ='block';
                        $(".deleteSure").unbind("click");
                        $(".deleteCancle").unbind("click");
                        $('.deleteSure').click(function () {
                            //点击删除框的确认 调用删除系统部门接口
                            deleteBusinessPosition(id);
                        })
                        $('.deleteCancle').click(function () {
                            //点击删除框的取消  弹框消失 不做操作
                            deleteBackground.style.display ='none';
                        })
                    })
                }

            }
        });
    }

    /**
     * 删除平台岗位接口
     * @param id 岗位id
     */
    function deletePosition(id) {
        $.ajax({
            xhrFields: {
                withCredentials: true
            },
            type: "POST",
            url: defiUrl+"/api/SystemBase/v1/deletePosition",
            async: true,
            dataType: "json",
            data: {
                'token':sessionStorage.getItem('token'),
                'id':id
            },
            success: function (data) {
                if(data.result.code==4001){
                    alert('登录信息已过期，请重新登录！');
                    window.location.href='../../login.html';
                }else if(data.result.code==4004){
                    alert('您太久没操作了，请重新登录！');
                    window.location.href='../../login.html';
                }else if(data.result.code ==0){
                    alert('删除成功');
                    deleteBackground.style.display ='none';
                    pagination(getpositionList);
                }else if(data.result.code ==4003) {
                    alert('业务异常！');
                }
            }
        });
    }
    function editPosition(id,positionName) {
        $.ajax({
            xhrFields: {
                withCredentials: true
            },
            type: "POST",
            url: defiUrl+"/api/SystemBase/v1/editPosition",
            async: true,
            dataType: "json",
            data: {
                'token':sessionStorage.getItem('token'),
                'id':id,
                'positionName':positionName
            },
            success: function (data) {
                if(data.result.code==4001){
                    alert('登录信息已过期，请重新登录！');
                    window.location.href='../../login.html';
                }else if(data.result.code==4004){
                    alert('您太久没操作了，请重新登录！');
                    window.location.href='../../login.html';
                }else if(data.result.code ==0){
                    alert('编辑成功');
                    editBackground.style.display ='none';
                    pagination(getpositionList);
                }else if(data.result.code ==4003) {
                    alert('业务异常！');
                }

            }
        });
    }

    /**
     * 删除商家岗位接口
     * @param id 商家岗位id
     */
    function deleteBusinessPosition(id) {
        $.ajax({
            xhrFields: {
                withCredentials: true
            },
            type: "POST",
            url: defiUrl+"/api/SystemBase/v1/deleteBusiPosition",
            async: true,
            dataType: "json",
            data: {
                'token':sessionStorage.getItem('token'),
                'id':id
            },
            success: function (data) {
                if(data.result.code==4001){
                    alert('登录信息已过期，请重新登录！');
                    window.location.href='../../login.html';
                }else if(data.result.code==4004){
                    alert('您太久没操作了，请重新登录！');
                    window.location.href='../../login.html';
                }else if(data.result.code ==0){
                    alert('删除成功');
                    deleteBackground.style.display ='none';
                    pagination(getBusinesspositionList);
                }else if(data.result.code ==4003) {
                    alert('业务异常！');
                }

            }
        });
    }
    function editBusinessPosition(id,positionName){
        $.ajax({
            xhrFields: {
                withCredentials: true
            },
            type: "POST",
            url: defiUrl+"/api/SystemBase/v1/editBusiPosition",
            async: true,
            dataType: "json",
            data: {
                'token':sessionStorage.getItem('token'),
                'id':id,
                'positionName':positionName
            },
            success: function (data) {
                if(data.result.code==4001){
                    alert('登录信息已过期，请重新登录！');
                    window.location.href='../../login.html';
                }else if(data.result.code==4004){
                    alert('您太久没操作了，请重新登录！');
                    window.location.href='../../login.html';
                }else if(data.result.code ==0){
                    alert('编辑成功');
                    editBusiBackground.style.display ='none';
                    pagination(getBusinesspositionList);
                }else if(data.result.code ==4003) {
                    alert('业务异常！');
                }


            }
        });
    }

    //初始化加载一次分页数据 默认平台岗位数据
    window.onload = function () {
        pagination(getpositionList)
    }



</script>
</html>